<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="MA,Sheng-Chu">
    <meta name="description" content="購購物車頁面">
    <title>結帳頁面 | Medicinal&Plants</title>
    <!-- Fontawesome CDN -->
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" 
    integrity="sha512-Fo3rlrZj/k7ujTnHg4CGR2D7kSs0v4LLanw2qksYuRlEzO+tcaEPQogQ0KaoGN26/zrn20ImR1DfuLWnOo7aBA==" 
    crossorigin="anonymous" 
    referrerpolicy="no-referrer" />
    <!-- Icon  -->
    <link rel="shortcut icon" href="./img/logo.png" type="image/x-icon">
    <!-- CSS link  -->
    <link rel="stylesheet" href="./css/shopping-cart.css">
    <!-- shopping-layout link  -->
    <link rel="stylesheet" href="./css/shopcart-layout.css">
</head>
<body>
      <!-- header start  -->
      <header id="header">
        <div class="container">
            <div class="logo">
                <a  href="./index.html" title="回到首頁">Medicinal <span>plants.</a>
            </div>
            <nav>
                <ul>
                    <li><a class="nav-link" href="./index.html">Home</a></li>
                    <li><a class="nav-link" href="./about.html">About</a></li>
                    <li><a class="nav-link" href="./shop-list.html">Shop</a></li>
                    <li><a class="nav-link" href="./blog-list.html">Blog</a></li>
                    <li><a class="nav-link" href="./attend.html">Attend</a></li>
                    <li><a class="nav-link" href="./contact.html">Contact</a></li>
                    <li><a href="./shopping-cart.html" title="購物車"><i class="fas fa-shopping-cart"></i></a></li>
                    <li><a href="#"><i class="far fa-user-circle"></i></a></li>
                </ul>
            </nav>
            <div class="menu-btn">
                <ul>
                    <li><a href="./shopping-cart.html" title="購物車"><i class="fas fa-shopping-cart"></i></a></li>
                    <li><a href="#" title="登入"><i class="far fa-user-circle" ></i></a></li>
                    <li><a href="#"><i class="fas fa-bars"></i></a></li>
                </ul>
            </div>
        </div>
    </header>
    
    
    <!-- main  -->
    <main>
        <!-- banner  -->
        <section id="banner" style="background-image: url(./img/shopping-cart.jpg);width: 100%;height: 50vh;z-index: -1; background-size: cover; background-repeat: no-repeat;background-position: left;">
            <div class="container">
                <h1>Shopping cart</h1>
                <h3>請確認你的訂單</h3>
            </div>
            <div class="step">Step 01 <span>確認購物資訊</span></div>
        </section>

        <!-- 購物清單  -->
        <section id="list">
            <div class="container">
                <h2>訂單明細</h2>
                <table>
                    <thead>
                        <tr>
                            <th>刪除</th>
                            <th>商品圖片</th>
                            <th>商品名稱</th>
                            <th>價格</th>
                            <th>數量</th>
                            <th>總價<small>(TW)</small></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="order-item">
                            <td><i class="fa-solid fa-trash-can"></i></td>
                            <td><img src="./img/menu-1.jpg" ></td>
                            <td>金輝玫瑰</td>
                            <td>$ <span class="unit-price" >150.00</span></td>
                            <td><button class="minus">-</button><input class="qty" type="number" value="1"><button class="plus">+</button></td>
                            <td><strong>$ <span class="item-price"></span></strong></td>
                        </tr>
                        <tr class="order-item">
                            <td><i class="fa-solid fa-trash-can"></i></td>
                            <td><img src="./img/menu-2.jpg" ></td>
                            <td>粉紅佳人</td>
                            <td>$ <span class="unit-price" >120.00</span></td>
                            <td><button class="minus">-</button><input class="qty" type="number" value="1"><button class="plus">+</button></td>
                            <td><strong>$ <span class="item-price"></span></strong></td>
                        </tr>
                        <tr class="order-item">
                            <td><i class="fa-solid fa-trash-can"></i></td>
                            <td><img src="./img/menu-3.jpg" ></td>
                            <td>梅花</td>
                            <td>$ <span class="unit-price">220.00</span></td>
                            <td><button class="minus">-</button><input class="qty" type="number" value="1"><button class="plus">+</button></td>
                            <td><strong>$ <span class="item-price"></span></strong></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- 小結算區  -->
        <section id="sum-details" style="background-image: url(./img/shop-cart-bgi.jpg);width: 100%;">
            <div class="container">
                <div class="cards">
                    <h2>品牌合作</h2>
                    <p>以下企業員工消費可以有3%的優惠:<br>AAAAA公司 、BBBBB公司 、CCCCC公司 、DDDDD公司 、EEEEE公司。</p>
                    <h3>歡迎使用以下消費方式</h3>
                    <div class="credit-card">
                        <i class="fa-brands fa-cc-mastercard"></i>
                        <i class="fa-brands fa-cc-visa"></i>
                        <i class="fa-brands fa-paypal"></i>
                        <i class="fa-brands fa-amazon-pay"></i>
                        <i class="fa-brands fa-apple-pay"></i>
                        <i class="fa-brands fa-google-pay"></i>
                    </div>

                </div>
                <div class="sub-total">
                    <h3>結算項目</h3>
                    <table>
                        <tr>
                            <td>數量</td>
                            <td class="sum-count">1</td>
                        </tr>
                        <tr>
                            <td>小計</td>
                            <td>$ <span class="sum-subtotal">40.99</span></td>
                        </tr>
                        <tr>
                            <td>運費</td>
                            <td>$ <span class="sum-fee">60</span></td>
                        </tr>
                        <tr>
                            <td>總計</td>
                            <td>$ <span class="sum-total">100.99</span></td>
                        </tr>
                    </table>
                    <a href="./shopping-cart2.html">前往下一步<i class="fa-solid fa-angle-right"></i></a>
                </div>
            </div>
        </section>
    </main>

    <!-- scroll up btn  -->
    <div class="scroll-up-btn">
        <a href="#banner">
            <i class="fas fa-angle-up"></i>
        </a>
    </div>

    <!-- footer start  -->
    <footer>
        <div class="container">
            <div class="col-4">
                <h2>Medicinal <br><span>plants.</span></h2>
                <div class="phone">phone: <span>09-XXX-XXX-XXX</span></div>
                <div class="email">email: <span>abc123@gmail.com</span></div>
                <div class="address">address: <span>XXXXXXXXXXXXXXXXX</span></div>
            </div>
            <div class="col-4">
                <h3>footer-item</h3>
                <ul>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                </ul>
            </div>
            <div class="col-4">
                <h3>footer-item</h3>
                <ul>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                </ul>
            </div>
            <div class="col-4">
                <h3>footer-item</h3>
                <ul>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                </ul>
            </div>
            <div class="col-4">
                <h3>footer-item</h3>
                <ul>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                </ul>
            </div>
            <div class="col-4">
                <h3>footer-item</h3>
                <ul>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                    <li><a href="#">some tag</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-copyright">
            &#169; 2022 Medicinal plants All Right Reserved  |  Only for practice.
        </div>
    </footer>

    <!-- js link  -->
    <script src="./js/index.js"></script>
    <script>
        //上半區
            let orderElements = document.querySelectorAll('.order-item');
        let plusBtn = document.querySelectorAll('.plus');
        let minusBtn = document.querySelectorAll('.minus');
        let qtyInput = document.querySelectorAll('.qty');
        let itemSubtotal = document.querySelectorAll('.item-price');
        let unitPrice = document.querySelectorAll('.unit-price');
        //垃圾桶
        let deleteElements = document.querySelectorAll('.fa-trash-can');
        //小計區
        let sumCount = document.querySelector('.sum-count');
        let sumSubtotal = document.querySelector('.sum-subtotal');
        let sumFee = document.querySelector('.sum-fee');
        let sumTotal = document.querySelector('.sum-total');
        //載入畫面先跑一次
        window.onload = function () {
            calculateItemSubtotal();
        };
        //++
        plusBtn.forEach(function(plusbtn,index){
            plusbtn.addEventListener('click',function(){
                if(qtyInput[index].value < 100){
                qtyInput[index].value = Number(qtyInput[index].value)+1;
                }
                calculateItemSubtotal();
            });
        });
        //--
        minusBtn.forEach(function(minusbtn,index){
            minusbtn.addEventListener('click',function(){
                if(qtyInput[index].value > 1){
                qtyInput[index].value = Number(qtyInput[index].value)-1;
                }
                calculateItemSubtotal();
            });
        });
        // 單品小計：單價 * 數量
        function calculateItemSubtotal() {
            itemSubtotal.forEach(function (element, index) {
                let unit = parseFloat(unitPrice[index].textContent);
                let qty = parseFloat(qtyInput[index].value);
                element.innerHTML = unit * qty;
            });
            calculateOrderSum();
        }
        //輸入框發生變化時，重新計算單品小計
        qtyInput.forEach(function (element, index) {
            element.addEventListener("change", function () {
                if (qtyInput[index].value <= 0) {
                    qtyInput[index].value = 1;
                }
                calculateItemSubtotal();
            });
        });
        // 刪除購物車商品 
            deleteElements.forEach(function(deleteElement,index){
                deleteElement.addEventListener('click',function(){
                    let ture = confirm("是否要將該商品從購物車中刪除？");
                    if (ture) {
                        orderElements[index].remove();
                        calculateItemSubtotal();
                        calculateOrderSum();
                    } else {
                        return;
                    }
                });
            });
        //總計
        function calculateOrderSum() {
            let orderElements = document.querySelectorAll('.order-item');
            let count = 0;
            let subtotal = 0;
            let fee = 200;

            for (let i = 0; i < orderElements.length; i++) {
                // 計算商品數量總和
                count += parseInt(qtyInput[i].value);
                // 計算商品小計總和
                subtotal += parseFloat(itemSubtotal[i].textContent);
            }
            // 如果訂單小計總和大於等於 1000 則免運
            if (subtotal >= 1000) {
                fee = 0;
            }
            sumCount.innerHTML = count;
            sumSubtotal.innerHTML = subtotal;
            sumFee.innerHTML = fee;
            sumTotal.innerHTML = subtotal + fee;
        }
    </script>
</body>
</html>